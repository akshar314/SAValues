<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title> Self Adjusting computation App </title>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <div class="container">
        <div class="display">
            <h1 class="divTitle" onclick="toggleInputDisplay()"> To Do list </h1>
            <div id="toDo">
            	<!-- <div>
            		<div class="listItems" onclick="deleteItem(this)"> Dummy Text </div>
            		<div class="removeButton">
            			<img src="images/dustbin.png">
            		</div>
            		<div class="editButton"></div>
            	</div> -->
            </div>
        </div>
        <div class="input">
            <h3 class="divTitle"> Enter Item </h3>
            <div id="textArea" contenteditable="true" onkeypress="detectEnter(event,this)"></div>
        </div>
    </div>
    <script>
    // SAValue library
    class SAValue {
        constructor() {
            this._value = null
            this._domNode = null
            this._dependencies = []
        }
        get domNode() {
            return this._domNode
        }
        set domNode(val) {
            this._domNode = val
        }
        get value() {
            return this._value
        }
        set value(val) {
            this._value = val
            this._dependencies.forEach(f => f(this))
        }
        fetch(url) {
            fetch(url)
                .then(response => response.text())
                .then(body => this.value = body)
        }
        addDependency(f) {
            this._dependencies.push(f)
        }
    }
    // Array to store to-do items as SAValue Objects
    var toDoItems = []

    // add, edit, remove dependencies   
    function itemAction(listItem) {
        var parent = document.getElementById('toDo')
        // Add item
        if (!listItem.domNode) {
        	// creating a div element
        	toDoItems.push(listItem)
            var div = document.createElement('div')
            div.setAttribute('class', 'listItems')
            div.setAttribute('onclick', 'deleteItem(this)')
            div.textContent = listItem.value
            // inserting the div element to DOM
            parent.insertBefore(div, parent.firstChild)
            // setting the domNode property of Value Object to div element
            listItem.domNode = div
        }
        // Remove item
        else if (listItem.domNode && !listItem.value) {
            var valueObj = listItem.domNode
            // remove item from DOM
            valueObj.remove()
            // remove item from array
            var valIndex = toDoItems.findIndex((currValObj) => currValObj.domNode === valueObj)
			toDoItems.splice(valIndex, 1)
        }
        // Edit item
        else if (listItem.domNode && listItem.value) {
        	var valueObj = listItem.domNode

        }
    }
	// single click - remove item
	function deleteItem(item) {
	    // Finding the Value Object
	    var valueObj = toDoItems.find((currValObj) => item === currValObj.domNode)
	    valueObj.value = null
	}
	// To hide/show input area
	function toggleInputDisplay() {
	    var inputElement = document.getElementsByClassName('input')[0]
	    var displayElement = document.getElementsByClassName('display')[0]
	    inputElement.classList.toggle('hideElement')

	    // Move display to the right after hiding input div
	    if (inputElement.classList.contains('hideElement')) {
	        displayElement.classList.remove('displayLeft')
	        displayElement.classList.add('displayRight')
	    }
	    // Move display to the left
	    else {
	        displayElement.classList.remove('displayRight')
	        displayElement.classList.add('displayLeft')
	    }
	}
	// Adding item when 'Enter' is pressed
	function detectEnter(event, textArea) {
	    var code = (event.keyCode ? event.keyCode : event.which)
	    if (code == 13) {
	        // Creating new Value object
	        var valueObj = new SAValue()
	        // Adding dependencies to the Value Object
	        valueObj.addDependency(itemAction)
	        // Calling the dependencies on Value Object
	        valueObj.value = textArea.textContent
	        // Clearing input area
	        textArea.textContent = ''
	    }
	}
    </script>
</body>

</html>
