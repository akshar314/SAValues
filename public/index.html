<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
    <title> Self Adjusting computation App </title>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <div class="container">
        <div class="display">
            <h1 class="divTitle" onclick="toggleInputDisplay()"> To Do list </h1>
            <div id="toDo"></div>
        </div>
        <div class="input">
            <h3 class="divTitle"> Enter Item </h3>
            <div id="textArea" contenteditable="true" onkeypress="detectEnter(event,this)"></div>
        </div>
    </div>
    <script>
	class Value {
	    constructor(value) {
	    	this._value = value
	    	this._dependencies = []
	    }
	    get value() {
	    	return this._value
	    }
	    set value(val) {
	    	this._value = val
	    	this._dependencies.forEach(f => { 
	    		f(this) 
	    	})
	    }
	    fetch(url) {
	        fetch(url)
	            .then(response => response.text())
	            .then(body => this.value = body)
	    }
	    addDependency(f) {
	    	this._dependencies.push(f)
	    }
	}

    class ToDo {
        constructor() {
            this._items = []
            this._top = -1
        }
        set item(val) {
        	// Setting dependencies
	        val.addDependency(addItem)
	        val.addDependency(removeItem)

	        //Incrementing number of items in the array
	        this._top++

	        // Pusing the Value object into array
        	this._items.push(val)
        }
		get items() {
        	return this._items
        }
        set top(val) {
        	this._top = val
        }
        get top() {
        	return this._top
        }
     }

    // New todo list
    var toDoItem = new ToDo()

    // Add item
    function addItem(listItem) {
        var parent = document.getElementById('toDo')

        if (listItem.value != null && typeof listItem.value === 'string') {
            var div = document.createElement('div')
            div.setAttribute('class', 'listItems')
            div.setAttribute('id', `item${toDoItem.top}`)
            div.setAttribute('onclick', 'itemAction(this)')
            div.textContent = listItem.value
            parent.insertBefore(div, parent.firstChild)
        }    	
    }

    function removeItem(listItem) {
        var parent = document.getElementById('toDo')
        var valueObj = listItem.value

        if (valueObj != null && typeof valueObj === 'object') {

            // if action is to remove item
            if (valueObj.action === 'remove') {
                // remove item from DOM
                valueObj.item.remove()

                // remove item from array
                toDoItem._items.splice(valueObj.itemIndex, 1)
                toDoItem.top--

                // get all item nodes
                var itemNodes = parent.childNodes

                // Reorder id's of all toDo items
                var index = itemNodes.length - 1
                for(var i = 0; i < itemNodes.length; i++) {
                    // console.log(`Reordering ${itemNodes[i].getAttribute('id')} to item${index}`)
                    itemNodes[i].setAttribute('id', `item${index--}`)                    
                }
            }
        }
    }
    </script>
    <script type="text/javascript" src="js/main.js"></script>
</body>

</html>