<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title> Self Adjusting computation App </title>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <div class="container">
        <div class="display">
            <h1 class="divTitle" onclick="toggleInputDisplay()"> To Do list </h1>
            <div id="toDo"></div>
        </div>
        <div class="input">
            <h3 class="divTitle"> Enter Item </h3>
            <div id="textArea" contenteditable="true" onkeypress="detectEnter(event,this)"></div>
        </div>
    </div>
    <script>
    // SAValue library
    class SAValue {
        constructor() {
            this._value = null
            this._DOMNode = null
            this._dependencies = []
        }
        get DOMNode() {
            return this._DOMNode
        }
        set DOMNode(val) {
            this._DOMNode = val
        }
        get value() {
            return this._value
        }
        set value(val) {
            this._value = val
            this._dependencies.forEach(f => f(this))
        }
        fetch(url) {
            fetch(url)
                .then(response => response.text())
                .then(body => this.value = body)
        }
        addDependency(f) {
            this._dependencies.push(f)
        }
    }
    // To-do Object 
    var toDoItem = {
            '_items': [],
            set item(val) {
                // Setting dependencies
                val.addDependency(editItem)
                // Pushing the Value object into an array
                this._items.push(val)
            },
            get items() {
                return this._items
            }
        }
    // add, edit, remove dependencies   
    function editItem(listItem) {
        var parent = document.getElementById('toDo')
        // Add item
        if (!listItem.DOMNode) {
        	// creating a div element
            var div = document.createElement('div')
            div.setAttribute('class', 'listItems')
            div.setAttribute('onclick', 'itemAction(this)')
            div.textContent = listItem.value
            // inserting the div element to DOM
            parent.insertBefore(div, parent.firstChild)
            // setting the DOMNode property of Value Object to div element
            listItem.DOMNode = div
        }
        // Remove item
        else if (listItem.DOMNode && !listItem.value) {
            var valueObj = listItem.DOMNode
            // remove item from DOM
            valueObj.remove()
            // remove item from array
            var valIndex = toDoItem.items.findIndex((currValObj) => currValObj.DOMNode === valueObj)
			toDoItem.items.splice(valIndex, 1)
        }
    }
	// Edit or remove item based on user input
	function itemAction(item, action) {
	    // Finding the Value Object
	    var valueObj = toDoItem.items.find((currValObj) => item === currValObj.DOMNode)
	    // Deleting it if action is 'remove'
	    valueObj.value = null
	}
	// To hide/show input area
	function toggleInputDisplay() {
	    var inputElement = document.getElementsByClassName('input')[0]
	    var displayElement = document.getElementsByClassName('display')[0]
	    inputElement.classList.toggle('hideElement')

	    // Move display to the right after hiding input div
	    if (inputElement.classList.contains('hideElement')) {
	        displayElement.classList.remove('displayLeft')
	        displayElement.classList.add('displayRight')
	    }
	    // Move display to the left
	    else {
	        displayElement.classList.remove('displayRight')
	        displayElement.classList.add('displayLeft')
	    }
	}
	// Adding item when 'Enter' is pressed
	function detectEnter(event, textArea) {
	    var code = (event.keyCode ? event.keyCode : event.which)
	    if (code == 13) {
	        // Creating new Value object
	        var valueObj = new SAValue()
	        toDoItem.item = valueObj
	        // Calling the dependencies on Value Object
	        valueObj.value = textArea.textContent
	        // Clearing input area
	        textArea.textContent = ''
	    }
	}
    </script>
</body>

</html>
