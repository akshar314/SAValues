<!DOCTYPE html>
<html>

<head>
    <title> To-do list </title>
    <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
    <div class="container">
        <div class="display">
            <h1> To Do list </h1>
            <div id="add"></div>
            <div id="remove"></div>
            <div id="toDo"></div>
        </div>
        <div class="input">
            <h3> Enter Item </h3>
            <div id="textArea" contenteditable="true" onkeypress='detectEnter(event,this)'></div>
            <!-- <textarea id="inputArea" onkeypress='detectEnter(event,this)' autofocus></textarea> -->
        </div>
    </div>
    <script>
    class ToDo {
        constructor() {
            this._items = []
            this._currItem = null
            this._top = 0
            this._dependencies = []
        }

        get item() {
            return this._items
        }

        set item(val) {
            this._currItem = val

            if (this._currItem != null)
                this._items.push(val)

            this._dependencies.forEach(f => {
                f(this)
            })

            this._currItem = null
        }

        addDependency(f) {
            this._dependencies.push(f)
        }
    }

    // New todo list
    var toDoItem = new ToDo()

    // Add and remove items
    toDoItem.addDependency((list) => {

        var parent = document.getElementById('toDo')

        // add item
        if (list._currItem != null) {
            var div = document.createElement('div')
                // p.setAttribute('contenteditable', 'true')
            div.setAttribute('class', 'listItems')
            div.textContent = list._items[list._top++]
            parent.insertBefore(div, parent.firstChild)
        }
        // remove item
        else if (list._currItem == null && parent.hasChildNodes()) {
            parent.removeChild(parent.lastChild);
            list._items.pop()
            list._top--
        }
    });

    // When the user clicks on the green button
    document.getElementById('add').addEventListener('click', function(event) {
        var inputArea = document.getElementById('inputArea')
        toDoItem.item = inputArea.value
        inputArea.value = ''
    });

    // When the user clicks on the red button
    // document.getElementById('remove').addEventListener('click', function(event) {
    //     toDoItem.item = null;
    // });

    function detectEnter(event, textArea) {
        var code = (event.keyCode ? event.keyCode : event.which)
        if (code == 13) {
            toDoItem.item = textArea.textContent
            textArea.textContent = ''
        }
    }
    </script>
</body>

</html>
