<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Self Adjusting computation App</title>
  </head>
  <body>

    <div id="main">
        <div id="counter">
        </div>
        <button>Add</button><button>Sub</button>
    </div>


<script>

class Value {
    constructor(value) {
    	this._value = value
    	this._dependencies = []
    }

    get value() {
    	return this._value
    }

    set value(val) {
    	this._value = val
    	this._dependencies.forEach(f => f(this))
    }

    fetch(url) {
        fetch(url)
            .then(response => response.text())
            .then(body => this.value = body)
    }

    addDependency(f) {
    	this._dependencies.push(f)
    }
}

const counter = new Value()
counter.addDependency(counter => 
    document.getElementById('counter').textContent = counter.value)

document.querySelectorAll('button')[0]
    .addEventListener('click', () => ++counter.value)
document.querySelectorAll('button')[1]
    .addEventListener('click', () => --counter.value)

counter.value = 0

var gpage = new Value()
gpage.addDependency(val => console.log(val.value))
gpage.fetch("index.html")

</script>

  </body>
</html>